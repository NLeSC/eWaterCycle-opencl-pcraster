<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>PCRaster LinkOut API: Application Programming Interface (API) for the PCRaster Model Engine</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li class="current"><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Application Programming Interface (API) for the PCRaster Model Engine </h1><p>The API consists of a series of C functions. The <a href="globals_func.html">list of functions</a> and <a class="el" href="main.html#examples">Api Examples</a> should be used as starting point.</p>
<h2><a class="anchor" id="deployment">
Deployment</a></h2>
<p>All functions reside in the dynamic library PCRasterModelEngine.dll/libPCRasterModelEngine.so. The dynamic libraries on which PCRasterModelEngine library depends are listed in the deployment.txt file in the Developer/LinkOut directory. Note that for linux all the libraries PCRasterModelEngine depends on are compiled with an rpath value of ".". That means that libraries should be installed in the same directory as PCRasterModelEngine itself.</p>
<h2><a class="anchor" id="conventions">
API conventions</a></h2>
<p>All functions have the calling convention common to the operating system the API is compiled for:</p>
<ul>
<li>linux/unix: cdecl</li>
<li>windows: stdcall</li>
</ul>
<p>The calling conventions rationale and the PCR_DLL_FUNC macro are present in pcrdll.h</p>
<p>Note that all strings (char *) are currently encoded as C-strings whith ANSI encoding (1 byte per char) and are not UniCode (2 bytes per char).</p>
<h2><a class="anchor" id="examples">
Api Examples</a></h2>
<p>The code examples are present in:</p>
<ul>
<li>apiExamples or</li>
<li>csharp/ScriptTest.cs collection of unit tests in a class named APITest in both C# (ScriptTest.cs) and C++</li>
</ul>
<p>the apiExamples directory uses the pcrcitd.exe driver to process the XML files (see demo.bat). pcrcitd looks like this:</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">      #include &lt;stdlib.h&gt;</span>
<span class="preprocessor">      #include &lt;stdio.h&gt;</span>

<span class="preprocessor">      #include &quot;<a class="code" href="pcrcalc_8h.html">pcrcalc.h</a>&quot;</span>


      <span class="keyword">static</span> <span class="keywordtype">void</span> checkError(<a class="code" href="pcrcalc_8h.html#ae02affc4b42263cf2aa930077f3267c0">PcrScript</a> *s)
      {
        <span class="keywordflow">if</span> (<a class="code" href="pcrcalc_8h.html#a7eda34df6c30d13450d01b52efcb431f">pcr_ScriptError</a>(s)) {
          fprintf(stderr,<a class="code" href="pcrcalc_8h.html#a06d9069e413faa07870f13015c40bded">pcr_ScriptErrorMessage</a>(s));
          exit(1);
        }
      }
 
     <span class="comment">// change &quot; within PCRasterLicense file to &#39; if neccesary</span>
     <span class="keyword">const</span> <span class="keywordtype">char</span> *licString =
     <span class="stringliteral">&quot;&lt;?xml version = &#39;1.0&#39; encoding = &#39;UTF-8&#39;?&gt;&quot;</span>\
     <span class="stringliteral">&quot; &lt;!DOCTYPE systemLicense PUBLIC &#39;-//PCRaster//Generic&#39; &#39;pcraster.dtd&#39;&gt;&quot;</span>\
     <span class="stringliteral">&quot;&lt;systemLicense&gt;&quot;</span>\
     <span class="stringliteral">&quot; &lt;licensee value=&#39;ThisCompany inc.&#39; /&gt;&quot;</span>\
     <span class="stringliteral">&quot; &lt;licensedFeature value=&#39;DevelopersLicense&#39; /&gt;&quot;</span>\
     <span class="stringliteral">&quot;  .... some elements removed .... &quot;</span>\
     <span class="stringliteral">&quot; &lt;licenseKey value=&#39;741604gy6s2k9ga0pfck24jg0l3ffo&#39; /&gt;&quot;</span>\
     <span class="stringliteral">&quot;&lt;/systemLicense&gt;&quot;</span>;
 
 
      <span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
      {
         <a class="code" href="pcrcalc_8h.html#ae02affc4b42263cf2aa930077f3267c0">PcrScript</a>* s;
         <span class="keywordtype">char</span>* installError;
         <span class="keywordflow">if</span> (argc &lt;= 1) {
           fprintf(stderr,<span class="stringliteral">&quot;PCRaster XML client interface test driver\n&quot;</span>);
           fprintf(stderr,<span class="stringliteral">&quot;USAGE: pcrcitd inputModelFile.xml\n&quot;</span>);
           exit(1);
         }
         <span class="keyword">const</span> <span class="keywordtype">char</span> *msg = pcr_installDevelopersLicense(licString);
         <span class="keywordflow">if</span> (msg) {
           fprintf(stderr,msg);
           exit(1);
         }
 
 
         <span class="comment">/* argv[1] is an xml file */</span>
         s=<a class="code" href="pcrcalc_8h.html#a7f99ded6ed5aa8a64e3f36c60f745e76" title="create the PcrScript object by supplying a filename of a XML file with the script...">pcr_createScriptFromXMLFile</a>(argv[1]);
         <span class="keywordflow">if</span> (!s) {
            printf(<span class="stringliteral">&quot;PANIC allocation of a few bytes failed&quot;</span>);
            abort();
         }
 
         <span class="comment">/* typical error: case.xml is not existant */</span>
         checkError(s);
 
         <a class="code" href="pcrcalc_8h.html#a2fe8d8b91735be6311dd52ea89a5dd77" title="Execute entire script.">pcr_ScriptExecute</a>(s);
         <span class="comment">/* typical errors:</span>
<span class="comment"> - case.xml is malformed</span>
<span class="comment"> - some inputs are not found</span>
<span class="comment"> - resource error: memory/disk full</span>
<span class="comment">          */</span>
         checkError(s);
 
         <a class="code" href="pcrcalc_8h.html#a514a9ec3d9ade56ecc6b47c2620aceda" title="clean up PcrScript object">pcr_destroyScript</a>(s);
 
         <span class="keywordflow">return</span> 0;
      }
</pre></div><p>The examples in csharp/ScriptTest.cs uses the API "as-is" in respect to minimizing the use of C# language features. Therefor the code can be used as examples for other client languages such as Java, Delphi or Visual Basic.</p>
<h2><a class="anchor" id="xmlDocumentation">
The XML vocabulary</a></h2>
<p>A single XML vocabulary defined in PCRaster.xsd is used in two roles (in and out):</p>
<ul>
<li>in: <a class="el" href="pcrcalc_8h.html#a7f99ded6ed5aa8a64e3f36c60f745e76" title="create the PcrScript object by supplying a filename of a XML file with the script...">pcr_createScriptFromXMLFile()</a>, <a class="el" href="pcrcalc_8h.html#abdea59f214d50874fb22905127ac09c6" title="create the PcrScript object by supplying the XML as a string with the script root...">pcr_createScriptFromXMLString()</a> to create a script.</li>
<li>out: pcr_ScriptXmlReflection() to retrieve meta information from a script.</li>
</ul>
<p>Within the PCRaster.xsd schema the XML nodes are documented within an xs:annotation element (view XML source in Visual Studio). The difference in application of the [in] and [out] case of certain nodes is clearly stated. Note that not all nodes present in PCRaster.xsd are used in the current API.</p>
<h2><a class="anchor" id="errorHandling">
Error Handling</a></h2>
<p>All functions will store a possible error description in the PcrScript object. The success of all functions can be checked of the function call by evaluating the result of <a class="el" href="pcrcalc_8h.html#a7eda34df6c30d13450d01b52efcb431f">pcr_ScriptError()</a> and/or <a class="el" href="pcrcalc_8h.html#a06d9069e413faa07870f13015c40bded">pcr_ScriptErrorMessage()</a>. Errors on a PcrScript object are NOT recoverable; All successive calls on the same PcrScript will do nothing. A PcrScript object in error state should still be deleted with <a class="el" href="pcrcalc_8h.html#a514a9ec3d9ade56ecc6b47c2620aceda" title="clean up PcrScript object">pcr_destroyScript()</a>. </p>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Mon Jul 15 00:06:29 2013 for PCRaster LinkOut API by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
