<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>PCRaster LinkOut API: pcrcalc.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>pcrcalc.h File Reference</h1><code>#include &quot;pcrdll.h&quot;</code><br/>
<div class="dynheader">
Include dependency graph for pcrcalc.h:</div>
<div class="dynsection">
<div class="center"><img src="pcrcalc_8h__incl.png" border="0" usemap="#pcrcalc_8h_map" alt=""/></div>
</div>

<p><a href="pcrcalc_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecalc.html">calc</a></td></tr>
<tr><td colspan="2"><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct Pcrcalc&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcrcalc_8h.html#ae02affc4b42263cf2aa930077f3267c0">PcrScript</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcrcalc_8h.html#afbc74fa8500d30343fde527fda556dd2">DataTransferArray</a> []</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcrcalc_8h.html#a92e121a6e03706aa31488e5aeb0cb6af">pcr_installDevelopersLicense</a> (const char *developersLicenseXMLString)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Install the DevelopersLicense.  <a href="#a92e121a6e03706aa31488e5aeb0cb6af"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcrcalc_8h.html#a22f3322728d974c7b15dee1f3fd8425c">pcr_createScriptFromTextFile</a> (const char *fileName)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">create the PcrScript object by supplying a filename of a text script file  <a href="#a22f3322728d974c7b15dee1f3fd8425c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcrcalc_8h.html#a7f99ded6ed5aa8a64e3f36c60f745e76">pcr_createScriptFromXMLFile</a> (const char *fileName)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">create the PcrScript object by supplying a filename of a XML file with the script root element  <a href="#a7f99ded6ed5aa8a64e3f36c60f745e76"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcrcalc_8h.html#a38f25747d83edc3fd07e020a88d74977">pcr_createScriptFromTextString</a> (const char *scriptContents)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">create the PcrScript object by supplying the textual script as string  <a href="#a38f25747d83edc3fd07e020a88d74977"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcrcalc_8h.html#abdea59f214d50874fb22905127ac09c6">pcr_createScriptFromXMLString</a> (const char *xmlString)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">create the PcrScript object by supplying the XML as a string with the script root element  <a href="#abdea59f214d50874fb22905127ac09c6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcrcalc_8h.html#a514a9ec3d9ade56ecc6b47c2620aceda">pcr_destroyScript</a> (<a class="el" href="pcrcalc_8h.html#ae02affc4b42263cf2aa930077f3267c0">PcrScript</a> *script)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">clean up PcrScript object  <a href="#a514a9ec3d9ade56ecc6b47c2620aceda"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcrcalc_8h.html#a7eda34df6c30d13450d01b52efcb431f">pcr_ScriptError</a> (<a class="el" href="pcrcalc_8h.html#ae02affc4b42263cf2aa930077f3267c0">PcrScript</a> *script)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcrcalc_8h.html#a06d9069e413faa07870f13015c40bded">pcr_ScriptErrorMessage</a> (<a class="el" href="pcrcalc_8h.html#ae02affc4b42263cf2aa930077f3267c0">PcrScript</a> *script)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcrcalc_8h.html#a85c499f17146e41a065c2806b850f240">pcr_ScriptXMLReflection</a> (<a class="el" href="pcrcalc_8h.html#ae02affc4b42263cf2aa930077f3267c0">PcrScript</a> *script)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">PCRaster script XML document.  <a href="#a85c499f17146e41a065c2806b850f240"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcrcalc_8h.html#a2fe8d8b91735be6311dd52ea89a5dd77">pcr_ScriptExecute</a> (<a class="el" href="pcrcalc_8h.html#ae02affc4b42263cf2aa930077f3267c0">PcrScript</a> *script)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Execute entire script.  <a href="#a2fe8d8b91735be6311dd52ea89a5dd77"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcrcalc_8h.html#a3df23e23d1ef0851b972a009d611e2a4">pcr_ScriptExecuteInitialStepMemory</a> (<a class="el" href="pcrcalc_8h.html#ae02affc4b42263cf2aa930077f3267c0">PcrScript</a> *script, <a class="el" href="pcrcalc_8h.html#afbc74fa8500d30343fde527fda556dd2">DataTransferArray</a> dataTransferArray)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Execute the initial section only.  <a href="#a3df23e23d1ef0851b972a009d611e2a4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcrcalc_8h.html#a194239250189a664352fc2b55bcc41dd">pcr_ScriptExecuteNextTimeStepMemory</a> (<a class="el" href="pcrcalc_8h.html#ae02affc4b42263cf2aa930077f3267c0">PcrScript</a> *script, <a class="el" href="pcrcalc_8h.html#afbc74fa8500d30343fde527fda556dd2">DataTransferArray</a> dataTransferArray)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Execute a timestep.  <a href="#a194239250189a664352fc2b55bcc41dd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcrcalc_8h.html#a9df104fc3ec8b2b1ea215763666ee9bf">pcr_ScriptExecuteFinish</a> (<a class="el" href="pcrcalc_8h.html#ae02affc4b42263cf2aa930077f3267c0">PcrScript</a> *script)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">End execution started with <a class="el" href="pcrcalc_8h.html#a3df23e23d1ef0851b972a009d611e2a4" title="Execute the initial section only.">pcr_ScriptExecuteInitialStepMemory()</a> and <a class="el" href="pcrcalc_8h.html#a194239250189a664352fc2b55bcc41dd" title="Execute a timestep.">pcr_ScriptExecuteNextTimeStepMemory()</a> sequence.  <a href="#a9df104fc3ec8b2b1ea215763666ee9bf"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">calc::ASTScript const &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcrcalc_8h.html#ace1ed8a78808419786156421c788fdc8">pcr_internalScript</a> (<a class="el" href="pcrcalc_8h.html#ae02affc4b42263cf2aa930077f3267c0">PcrScript</a> *script)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">not part of the API  <a href="#ace1ed8a78808419786156421c788fdc8"></a><br/></td></tr>
</table>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="afbc74fa8500d30343fde527fda556dd2"></a><!-- doxytag: member="pcrcalc.h::DataTransferArray" ref="afbc74fa8500d30343fde527fda556dd2" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void* <a class="el" href="pcrcalc_8h.html#afbc74fa8500d30343fde527fda556dd2">DataTransferArray</a>[]</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Both stepwise functions, <a class="el" href="pcrcalc_8h.html#a3df23e23d1ef0851b972a009d611e2a4" title="Execute the initial section only.">pcr_ScriptExecuteInitialStepMemory()</a> and <a class="el" href="pcrcalc_8h.html#a194239250189a664352fc2b55bcc41dd" title="Execute a timestep.">pcr_ScriptExecuteNextTimeStepMemory()</a>, have a dataTransferArray argument used for transferring data. dataTransferArray is a low level interface. The memory layout of DataTransferArray is specified in the script XML document.</p>
<p>dataTransferArray is the address of an array of addresses (in C terms: an array of void pointers). The index in the array is the nominal value presented in the definition/{scriptInput/scriptOutput}/memoryExchange element. The array must have an entry for each memoryExchange element present. If the entry is not 0, then the entry is the address of a transfer buffer.</p>
<p>The semantics of the transfer buffer depends on if the memoryExchange element appears in a scriptInput or scriptOutput element:</p>
<ul>
<li><b>scriptInput</b>: The buffer does contain a value for the item, when the stepwise function is called. The buffer is not modified when the stepwise function returns. An entry may be 0 if the corresponding memoryExchange element is not used in either the initial or dynamic section for which the stepwise function is called. If it used, but 0 is passed a runtime error will occur (see <a class="el" href="pcrcalc_8h.html#a7eda34df6c30d13450d01b52efcb431f">pcr_ScriptError()</a>).</li>
<li><b>scriptOutput</b>: If the buffer is not 0 when the stepwise function is called then the caller has reserved enough space at the buffer address. The stepwise function will copy data into the buffer. If the buffer is 0 the stepwise function will allocate it (see allocation by the function below).</li>
</ul>
<h2><a class="anchor" id="functionAllocation">
Allocation by the Function</a></h2>
<p>If the buffer is 0 the stepwise function will allocate it. The buffer allocated should not be deleted/freed by the caller nor should the address by passed back in a successive call to a stepwise function. A successive call to a stepwise function or <a class="el" href="pcrcalc_8h.html#a514a9ec3d9ade56ecc6b47c2620aceda" title="clean up PcrScript object">pcr_destroyScript()</a> will delete the buffer. Thus the buffer is only valid until such a next call.</p>
<p><b>Rule</b>: Buffers allocated by the caller should be deleted by the caller. Buffers allocated by the stepwise functions will be deleted by a next stepwise function or <a class="el" href="pcrcalc_8h.html#a514a9ec3d9ade56ecc6b47c2620aceda" title="clean up PcrScript object">pcr_destroyScript()</a> call.</p>
<h2><a class="anchor" id="transferBuffer">
Transfer Buffer layout</a></h2>
<p>The transfer buffer is either:</p>
<ul>
<li>a field buffer, if the definition element the memoryExchange element is appearing in holds a field element.</li>
<li>an indexedArray buffer, if the definition element the memoryExchange element is appearing in holds an indexedArray element.</li>
<li>a textString buffer if the definition element's name is used in a textStatistics element.</li>
<li>a timeoutputRow buffer if the definition element's name is assigned the result of a timeoutput function in the model.</li>
</ul>
<h3><a class="anchor" id="fieldBufferMemoryLayout">
Field Buffer Memory Layout</a></h3>
<p>A field buffer consist of one the following elementary types:</p>
<ul>
<li>unsigned char (UINT1): 8-bit byte for Boolean and Ldd.</li>
<li>int (INT4): 32 bit integer for Nominal and Ordinal.</li>
<li>float (REAL4): 32 bit float for Scalar and Directional.</li>
</ul>
<p>The field buffer is either:</p>
<ul>
<li>a single value if the definition element contains the spatialType element with the value NonSpatial</li>
<li>an array of size areaMap/nrRows * areaMap/nrCols if the field definition element contains the spatialType element with the value Spatial</li>
</ul>
<h3><a class="anchor" id="indexedArrayBufferMemoryLayout">
IndexedArray Buffer Memory Layout</a></h3>
<p>An indexedArray buffer consists of two parts: a header followed by the data.</p>
<p>The header consists of 1+NDIM values of the type specified in the indexedArray/dimensionDataType element. The first value of the header represent the number of dimensions (NDIM). Successive values will give the length of each dimension.</p>
<p>The data consists of X values of the type specified in the indexedArray/valueDataType. X is the multiplication of all dimension lengths.</p>
<p>Currently only a 1 dimensional array is needed to use the lookup... functions with an indexedArray element. For example an array of 1 by 3 with the array values 1.33, 2.33 and 3.33 will have the following layout: </p>
<div class="fragment"><pre class="fragment">
      1    # number of dimensions
      3    # length of dimension 1
      1.33
      2.33
      3.33
    </pre></div><h3><a class="anchor" id="textStringMemoryLayout">
textString Buffer Memory Layout</a></h3>
<p>A 0-terminated ANSI character string. Since the buffer is of unknown length upon calling it is recommended to let the function allocate this buffer (pass 0 in, get address out).</p>
<h3><a class="anchor" id="timeoutputRowLayout">
timeoutput Buffer Memory Layout</a></h3>
<p>In essence this a 1 dimensional array of values as they would appear on a row of a pcrcalc timeoutput tss file, with the time column removed.</p>
<p>The memory buffer does however prepend a header of 4 unsigned integers (INT4):</p>
<ul>
<li>0. Always holds value 1 (to allow other versions in the future).</li>
<li>1. Constant (matching the CSF_CR enum of the PCRaster file format API) identifying the type of the row entries:<ul>
<li>0 (0x00) for UINT1 (unsigned char)</li>
<li>38 (0x26) for INT4 (signed int)</li>
<li>90 (0x5A) for REAL4 (float)</li>
</ul>
</li>
<li>2. Always holds value 1 (the number of dimensions of this buffer).</li>
<li>3. The number of entries following (length of dimension 1).</li>
</ul>
<p>After the header the row entries will follow which are of the type identified by header item 1 and the number of entries by header item 3.</p>
<p>Since the buffer is of unknown length upon calling it is recommended to let the function allocate this buffer (pass 0 in, get address out). </p>

<p>Definition at line <a class="el" href="pcrcalc_8h_source.html#l00127">127</a> of file <a class="el" href="pcrcalc_8h_source.html">pcrcalc.h</a>.</p>

</div>
</div>
<a class="anchor" id="ae02affc4b42263cf2aa930077f3267c0"></a><!-- doxytag: member="pcrcalc.h::PcrScript" ref="ae02affc4b42263cf2aa930077f3267c0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct Pcrcalc <a class="el" href="pcrcalc_8h.html#ae02affc4b42263cf2aa930077f3267c0">PcrScript</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pcrcalc_8h_source.html#l00032">32</a> of file <a class="el" href="pcrcalc_8h_source.html">pcrcalc.h</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a22f3322728d974c7b15dee1f3fd8425c"></a><!-- doxytag: member="pcrcalc.h::pcr_createScriptFromTextFile" ref="a22f3322728d974c7b15dee1f3fd8425c" args="(const char *fileName)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pcr_createScriptFromTextFile </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>fileName</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>create the PcrScript object by supplying a filename of a text script file </p>
<p>pcr_createScriptFromTextFile allocates some internal memory to set up error handling. No other actions, such as checking if the fileName exists or the script has a valid syntax, are taken here. All these actions are deferred to a next call that needs the script such as <a class="el" href="pcrcalc_8h.html#a2fe8d8b91735be6311dd52ea89a5dd77" title="Execute entire script.">pcr_ScriptExecute()</a> or <a class="el" href="pcrcalc_8h.html#a85c499f17146e41a065c2806b850f240" title="PCRaster script XML document.">pcr_ScriptXMLReflection()</a>.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>call <a class="el" href="pcrcalc_8h.html#a92e121a6e03706aa31488e5aeb0cb6af" title="Install the DevelopersLicense.">pcr_installDevelopersLicense()</a> first</dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fileName</em>&nbsp;</td><td>C-string (Ansi 1-byte char set) with name of script file. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a38f25747d83edc3fd07e020a88d74977"></a><!-- doxytag: member="pcrcalc.h::pcr_createScriptFromTextString" ref="a38f25747d83edc3fd07e020a88d74977" args="(const char *scriptContents)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pcr_createScriptFromTextString </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>scriptContents</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>create the PcrScript object by supplying the textual script as string </p>
<p>pcr_createScriptFromTextFile allocates some internal memory to set up error handling. No other actions, such as checking if the script has a valid syntax, are taken here. Al these actions are deferred to a next call that needs the script such as <a class="el" href="pcrcalc_8h.html#a2fe8d8b91735be6311dd52ea89a5dd77" title="Execute entire script.">pcr_ScriptExecute()</a> or <a class="el" href="pcrcalc_8h.html#a85c499f17146e41a065c2806b850f240" title="PCRaster script XML document.">pcr_ScriptXMLReflection()</a>.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>call <a class="el" href="pcrcalc_8h.html#a92e121a6e03706aa31488e5aeb0cb6af" title="Install the DevelopersLicense.">pcr_installDevelopersLicense()</a> first</dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>scriptContents</em>&nbsp;</td><td>C-string (Ansi 1-byte char set) with script contents </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a7f99ded6ed5aa8a64e3f36c60f745e76"></a><!-- doxytag: member="pcrcalc.h::pcr_createScriptFromXMLFile" ref="a7f99ded6ed5aa8a64e3f36c60f745e76" args="(const char *fileName)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pcr_createScriptFromXMLFile </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>fileName</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>create the PcrScript object by supplying a filename of a XML file with the script root element </p>
<p>pcr_createScriptFromXMLFile allocates some internal memory to set up error handling. No other actions, such as checking if the file exists or the script has a valid syntax, are taken here. All these actions are deferred to a next call that needs the script such as <a class="el" href="pcrcalc_8h.html#a2fe8d8b91735be6311dd52ea89a5dd77" title="Execute entire script.">pcr_ScriptExecute()</a> or <a class="el" href="pcrcalc_8h.html#a85c499f17146e41a065c2806b850f240" title="PCRaster script XML document.">pcr_ScriptXMLReflection()</a>.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>call <a class="el" href="pcrcalc_8h.html#a92e121a6e03706aa31488e5aeb0cb6af" title="Install the DevelopersLicense.">pcr_installDevelopersLicense()</a> first</dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fileName</em>&nbsp;</td><td>C-string (Ansi 1-byte char set) with name of script file </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="abdea59f214d50874fb22905127ac09c6"></a><!-- doxytag: member="pcrcalc.h::pcr_createScriptFromXMLString" ref="abdea59f214d50874fb22905127ac09c6" args="(const char *xmlString)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pcr_createScriptFromXMLString </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>xmlString</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>create the PcrScript object by supplying the XML as a string with the script root element </p>
<p>pcr_createScriptFromXMLString allocates some internal memory to set up error handling. No other actions, such as checking if the script has a valid syntax, are taken here. Al these actions are deferred to a next call that needs the script such as <a class="el" href="pcrcalc_8h.html#a2fe8d8b91735be6311dd52ea89a5dd77" title="Execute entire script.">pcr_ScriptExecute()</a> or <a class="el" href="pcrcalc_8h.html#a85c499f17146e41a065c2806b850f240" title="PCRaster script XML document.">pcr_ScriptXMLReflection()</a>.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>call <a class="el" href="pcrcalc_8h.html#a92e121a6e03706aa31488e5aeb0cb6af" title="Install the DevelopersLicense.">pcr_installDevelopersLicense()</a> first</dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>xmlString</em>&nbsp;</td><td>C-string (Ansi 1-byte char set) with script contents </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a514a9ec3d9ade56ecc6b47c2620aceda"></a><!-- doxytag: member="pcrcalc.h::pcr_destroyScript" ref="a514a9ec3d9ade56ecc6b47c2620aceda" args="(PcrScript *script)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pcr_destroyScript </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pcrcalc_8h.html#ae02affc4b42263cf2aa930077f3267c0">PcrScript</a> *&nbsp;</td>
          <td class="paramname"> <em>script</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>clean up PcrScript object </p>
<p>cleans up all dynamic data kept for <em>script</em> </p>

</div>
</div>
<a class="anchor" id="a92e121a6e03706aa31488e5aeb0cb6af"></a><!-- doxytag: member="pcrcalc.h::pcr_installDevelopersLicense" ref="a92e121a6e03706aa31488e5aeb0cb6af" args="(const char *developersLicenseXMLString)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pcr_installDevelopersLicense </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>developersLicenseXMLString</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Install the DevelopersLicense. </p>
<p>The <em>developersLicenseXMLString</em> contains the contents of the PCRasterLicense file containing all licensed features purchased by you. To use the PCRaster API it should at least contain the DevelopersLicense feature.</p>
<p><a class="el" href="pcrcalc_8h.html#a92e121a6e03706aa31488e5aeb0cb6af" title="Install the DevelopersLicense.">pcr_installDevelopersLicense()</a> must always precede any other calls of the PCRaster API.</p>
<p><b> The PCRasterLicense file contents may not be distributed as a separate file, outside the organization of the license holder. The sole exception is that the contents of the PCRasterLicense file can be distributed as a string in a binary file that is not intended to be read by humans. Examples of these binary files are a Windows dll or Java class file. </b></p>
<p>The above means that the PCRasterLicense file must be compiled as a string constant in the program that uses the API.</p>
<p><b>Important for software testing:</b> The PCRaster API will add the features found in <em>developersLicenseXMLString</em> to the licensed features found in the PCRasterLicense file that may be present with the PCRaster distribution. Rename a possible PCRasterLicense file to test the setup where the user does not have its own PCRasterLicense.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>developersLicenseXMLString</em>&nbsp;</td><td>C-string (Ansi 1-byte char set) with license contents. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 if no error, a pointer to a C-string with the error message in case of an error.</dd></dl>
<div class="fragment"><pre class="fragment">  <span class="comment">// change &quot; within PCRasterLicense file to &#39; if necessary</span>
  <span class="keyword">const</span> <span class="keywordtype">char</span> *licString =
  <span class="stringliteral">&quot;&lt;?xml version = &#39;1.0&#39; encoding = &#39;UTF-8&#39;?&gt;&quot;</span>\
  <span class="stringliteral">&quot; &lt;!DOCTYPE systemLicense PUBLIC &#39;-//PCRaster//Generic&#39; &#39;pcraster.dtd&#39;&gt;&quot;</span>\
  <span class="stringliteral">&quot;&lt;systemLicense&gt;&quot;</span>\
  <span class="stringliteral">&quot; &lt;licensee value=&#39;ThisCompany inc.&#39; /&gt;&quot;</span>\
  <span class="stringliteral">&quot; &lt;licensedFeature value=&#39;DevelopersLicense&#39; /&gt;&quot;</span>\
  <span class="stringliteral">&quot;  .... some elements removed .... &quot;</span>\
  <span class="stringliteral">&quot; &lt;licenseKey value=&#39;741604gy6s2k9ga0pfck24jg0l3ffo&#39; /&gt;&quot;</span>\
  <span class="stringliteral">&quot;&lt;/systemLicense&gt;&quot;</span>;

  <span class="keyword">const</span> <span class="keywordtype">char</span> *msg = <a class="code" href="pcrcalc_8h.html#a92e121a6e03706aa31488e5aeb0cb6af" title="Install the DevelopersLicense.">pcr_installDevelopersLicense</a>(licString);
  <span class="keywordflow">if</span> (msg) {
    fprintf(stderr,msg);
    exit(1);
  }
</pre></div> 
</div>
</div>
<a class="anchor" id="ace1ed8a78808419786156421c788fdc8"></a><!-- doxytag: member="pcrcalc.h::pcr_internalScript" ref="ace1ed8a78808419786156421c788fdc8" args="(PcrScript *script)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">calc::ASTScript const&amp; pcr_internalScript </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pcrcalc_8h.html#ae02affc4b42263cf2aa930077f3267c0">PcrScript</a> *&nbsp;</td>
          <td class="paramname"> <em>script</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>not part of the API </p>

</div>
</div>
<a class="anchor" id="a7eda34df6c30d13450d01b52efcb431f"></a><!-- doxytag: member="pcrcalc.h::pcr_ScriptError" ref="a7eda34df6c30d13450d01b52efcb431f" args="(PcrScript *script)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pcr_ScriptError </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pcrcalc_8h.html#ae02affc4b42263cf2aa930077f3267c0">PcrScript</a> *&nbsp;</td>
          <td class="paramname"> <em>script</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>check if an error has occured </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>script</em>&nbsp;</td><td>the script object</td></tr>
  </table>
  </dd>
</dl>
<p>Read <a class="el" href="main.html#errorHandling">Error Handling</a> on how errors are handled.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 if no error present for <em>script</em>, otherwise the size of the string (excl. terminating 0) returned by <a class="el" href="pcrcalc_8h.html#a06d9069e413faa07870f13015c40bded">pcr_ScriptErrorMessage()</a> </dd></dl>

</div>
</div>
<a class="anchor" id="a06d9069e413faa07870f13015c40bded"></a><!-- doxytag: member="pcrcalc.h::pcr_ScriptErrorMessage" ref="a06d9069e413faa07870f13015c40bded" args="(PcrScript *script)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pcr_ScriptErrorMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pcrcalc_8h.html#ae02affc4b42263cf2aa930077f3267c0">PcrScript</a> *&nbsp;</td>
          <td class="paramname"> <em>script</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>get error message </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>script</em>&nbsp;</td><td>the script object</td></tr>
  </table>
  </dd>
</dl>
<p>Read <a class="el" href="main.html#errorHandling">Error Handling</a> on how errors are handled.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>a C-string (Ansi 1-byte char set), empty string if no error present for <em>script</em>, otherwise the error message. </dd></dl>

</div>
</div>
<a class="anchor" id="a2fe8d8b91735be6311dd52ea89a5dd77"></a><!-- doxytag: member="pcrcalc.h::pcr_ScriptExecute" ref="a2fe8d8b91735be6311dd52ea89a5dd77" args="(PcrScript *script)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pcr_ScriptExecute </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pcrcalc_8h.html#ae02affc4b42263cf2aa930077f3267c0">PcrScript</a> *&nbsp;</td>
          <td class="paramname"> <em>script</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Execute entire script. </p>
<p>This execute variant expects all data to present as files on the filesystem, in contrast to the <a class="el" href="pcrcalc_8h.html#a3df23e23d1ef0851b972a009d611e2a4" title="Execute the initial section only.">pcr_ScriptExecuteInitialStepMemory()</a> and <a class="el" href="pcrcalc_8h.html#a194239250189a664352fc2b55bcc41dd" title="Execute a timestep.">pcr_ScriptExecuteNextTimeStepMemory()</a> setup. </p>

</div>
</div>
<a class="anchor" id="a9df104fc3ec8b2b1ea215763666ee9bf"></a><!-- doxytag: member="pcrcalc.h::pcr_ScriptExecuteFinish" ref="a9df104fc3ec8b2b1ea215763666ee9bf" args="(PcrScript *script)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pcr_ScriptExecuteFinish </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pcrcalc_8h.html#ae02affc4b42263cf2aa930077f3267c0">PcrScript</a> *&nbsp;</td>
          <td class="paramname"> <em>script</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>End execution started with <a class="el" href="pcrcalc_8h.html#a3df23e23d1ef0851b972a009d611e2a4" title="Execute the initial section only.">pcr_ScriptExecuteInitialStepMemory()</a> and <a class="el" href="pcrcalc_8h.html#a194239250189a664352fc2b55bcc41dd" title="Execute a timestep.">pcr_ScriptExecuteNextTimeStepMemory()</a> sequence. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>script</em>&nbsp;</td><td>the script object</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd><ul>
<li>-1 finishing raised an error, check <a class="el" href="pcrcalc_8h.html#a06d9069e413faa07870f13015c40bded">pcr_ScriptErrorMessage(PcrScript *script)</a></li>
<li>0 finished with no error</li>
</ul>
<a class="el" href="pcrcalc_8h.html#a514a9ec3d9ade56ecc6b47c2620aceda" title="clean up PcrScript object">pcr_destroyScript()</a> will perform the same actions but <a class="el" href="pcrcalc_8h.html#a514a9ec3d9ade56ecc6b47c2620aceda" title="clean up PcrScript object">pcr_destroyScript()</a> can not return an error message. Only needed if caller wants to terminate before end of model or if model does not know the number of timesteps itself. </dd></dl>

</div>
</div>
<a class="anchor" id="a3df23e23d1ef0851b972a009d611e2a4"></a><!-- doxytag: member="pcrcalc.h::pcr_ScriptExecuteInitialStepMemory" ref="a3df23e23d1ef0851b972a009d611e2a4" args="(PcrScript *script, DataTransferArray dataTransferArray)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pcr_ScriptExecuteInitialStepMemory </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pcrcalc_8h.html#ae02affc4b42263cf2aa930077f3267c0">PcrScript</a> *&nbsp;</td>
          <td class="paramname"> <em>script</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pcrcalc_8h.html#afbc74fa8500d30343fde527fda556dd2">DataTransferArray</a>&nbsp;</td>
          <td class="paramname"> <em>dataTransferArray</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Execute the initial section only. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>script</em>&nbsp;</td><td>the script object </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dataTransferArray</em>&nbsp;</td><td>see DataTransferArray</td></tr>
  </table>
  </dd>
</dl>
<p>If the model is a static model, the entire model is executed. Repetive calls will do nothing; for each script object the initial section can only be called once.</p>
<p>Calling this function more than once will result in an error.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd><ul>
<li>-1 model terminated in error, check <a class="el" href="pcrcalc_8h.html#a06d9069e413faa07870f13015c40bded">pcr_ScriptErrorMessage(PcrScript *script)</a></li>
<li>0 initial step is executed, model finished thus it is a static model.</li>
<li>1 initial step is executed, model not yet finished, thus it is a dynamic model.</li>
</ul>
</dd></dl>
<dl class="warning"><dt><b>Warning:</b></dt><dd>The function will not put an output into <em>dataTransferArray</em> if that output is also re-computed in the dynamic section: <div class="fragment"><pre class="fragment">
    initial
     # pcr_ScriptExecuteInitialStepMemory will *NOT* put value of out in dataTransferArray
     out = in * 1;
    dynamic
     # pcr_ScriptExecuteNextTimeStepMemory will put value of out in dataTransferArray
     out =  f(out, ...);
    </pre></div> This is consistent how pcrcalc deals with output map stacks versus single map output. If you need the initial value use an auxiliary variable (no performance penalty): <div class="fragment"><pre class="fragment">
    initial
     # pcr_ScriptExecuteInitialStepMemory will *NOT* put value of out in dataTransferArray
     out = in * 1;
     # pcr_ScriptExecuteInitialStepMemory cat put this value in dataTransferArray
     staticOut = out;
    dynamic
     # pcr_ScriptExecuteNextTimeStepMemory will put value of out in dataTransferArray
     out =  f(out, ...);
    </pre></div> </dd></dl>

</div>
</div>
<a class="anchor" id="a194239250189a664352fc2b55bcc41dd"></a><!-- doxytag: member="pcrcalc.h::pcr_ScriptExecuteNextTimeStepMemory" ref="a194239250189a664352fc2b55bcc41dd" args="(PcrScript *script, DataTransferArray dataTransferArray)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pcr_ScriptExecuteNextTimeStepMemory </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pcrcalc_8h.html#ae02affc4b42263cf2aa930077f3267c0">PcrScript</a> *&nbsp;</td>
          <td class="paramname"> <em>script</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pcrcalc_8h.html#afbc74fa8500d30343fde527fda556dd2">DataTransferArray</a>&nbsp;</td>
          <td class="paramname"> <em>dataTransferArray</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Execute a timestep. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>script</em>&nbsp;</td><td>the script object </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dataTransferArray</em>&nbsp;</td><td>Execute next time step. Calling this function without first calling <a class="el" href="pcrcalc_8h.html#a3df23e23d1ef0851b972a009d611e2a4" title="Execute the initial section only.">pcr_ScriptExecuteInitialStepMemory()</a> will result in an error.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd><ul>
<li>-1 model terminated in error, check <a class="el" href="pcrcalc_8h.html#a06d9069e413faa07870f13015c40bded">pcr_ScriptErrorMessage(PcrScript *script)</a></li>
<li>0 a timestep is executed, model finished; this call executed the last timestep.</li>
<li>1 a timestep is executed, model not yet finished, more steps may follow.</li>
</ul>
</dd></dl>

</div>
</div>
<a class="anchor" id="a85c499f17146e41a065c2806b850f240"></a><!-- doxytag: member="pcrcalc.h::pcr_ScriptXMLReflection" ref="a85c499f17146e41a065c2806b850f240" args="(PcrScript *script)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pcr_ScriptXMLReflection </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pcrcalc_8h.html#ae02affc4b42263cf2aa930077f3267c0">PcrScript</a> *&nbsp;</td>
          <td class="paramname"> <em>script</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>PCRaster script XML document. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>script</em>&nbsp;</td><td>the script object</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 in case of error, C-string (Ansi 1-byte char set) with document otherwise. </dd></dl>

</div>
</div>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Tue Mar 22 12:15:25 2011 for PCRaster LinkOut API by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
