<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>PCRaster LinkOut API: Application Programming Interface (API) for the PCRaster Model Engine</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PCRaster LinkOut API
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Application Programming Interface (API) for the PCRaster Model Engine </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The API consists of a series of C functions. The <a href="globals_func.html">list of functions</a> and <a class="el" href="index.html#examples">Api Examples</a> should be used as starting point.</p>
<h1><a class="anchor" id="deployment"></a>
Deployment</h1>
<p>All functions reside in the dynamic library PCRasterModelEngine.dll/libPCRasterModelEngine.so. The dynamic libraries on which PCRasterModelEngine library depends are listed in the deployment.txt file in the Developer/LinkOut directory. Note that for linux all the libraries PCRasterModelEngine depends on are compiled with an rpath value of ".". That means that libraries should be installed in the same directory as PCRasterModelEngine itself.</p>
<h1><a class="anchor" id="conventions"></a>
API conventions</h1>
<p>All functions have the calling convention common to the operating system the API is compiled for:</p>
<ul>
<li>linux/unix: cdecl</li>
<li>windows: stdcall</li>
</ul>
<p>The calling conventions rationale and the PCR_DLL_FUNC macro are present in pcrdll.h</p>
<p>Note that all strings (char *) are currently encoded as C-strings whith ANSI encoding (1 byte per char) and are not UniCode (2 bytes per char).</p>
<h1><a class="anchor" id="examples"></a>
Api Examples</h1>
<p>The code examples are present in:</p>
<ul>
<li>apiExamples or</li>
<li>csharp/ScriptTest.cs collection of unit tests in a class named APITest in both C# (ScriptTest.cs) and C++</li>
</ul>
<p>the apiExamples directory uses the pcrcitd.exe driver to process the XML files (see demo.bat). pcrcitd looks like this:</p>
<div class="fragment"><div class="line"><span class="preprocessor"> #include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor"> #include &lt;stdio.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor"> #include &quot;<a class="code" href="pcrcalc_8h.html">pcrcalc.h</a>&quot;</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"> <span class="keyword">static</span> <span class="keywordtype">void</span> checkError(<a class="code" href="pcrcalc_8h.html#ae02affc4b42263cf2aa930077f3267c0">PcrScript</a> *s)</div>
<div class="line"> {</div>
<div class="line">   <span class="keywordflow">if</span> (<a class="code" href="pcrcalc_8h.html#a7eda34df6c30d13450d01b52efcb431f">pcr_ScriptError</a>(s)) {</div>
<div class="line">     fprintf(stderr,<a class="code" href="pcrcalc_8h.html#a06d9069e413faa07870f13015c40bded">pcr_ScriptErrorMessage</a>(s));</div>
<div class="line">     exit(1);</div>
<div class="line">   }</div>
<div class="line"> }</div>
<div class="line"></div>
<div class="line"><span class="comment">// change &quot; within PCRasterLicense file to &#39; if neccesary</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *licString =</div>
<div class="line"><span class="stringliteral">&quot;&lt;?xml version = &#39;1.0&#39; encoding = &#39;UTF-8&#39;?&gt;&quot;</span>\</div>
<div class="line"><span class="stringliteral">&quot; &lt;!DOCTYPE systemLicense PUBLIC &#39;-//PCRaster//Generic&#39; &#39;pcraster.dtd&#39;&gt;&quot;</span>\</div>
<div class="line"><span class="stringliteral">&quot;&lt;systemLicense&gt;&quot;</span>\</div>
<div class="line"><span class="stringliteral">&quot; &lt;licensee value=&#39;ThisCompany inc.&#39; /&gt;&quot;</span>\</div>
<div class="line"><span class="stringliteral">&quot; &lt;licensedFeature value=&#39;DevelopersLicense&#39; /&gt;&quot;</span>\</div>
<div class="line"><span class="stringliteral">&quot;  .... some elements removed .... &quot;</span>\</div>
<div class="line"><span class="stringliteral">&quot; &lt;licenseKey value=&#39;741604gy6s2k9ga0pfck24jg0l3ffo&#39; /&gt;&quot;</span>\</div>
<div class="line"><span class="stringliteral">&quot;&lt;/systemLicense&gt;&quot;</span>;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"> <span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line"> {</div>
<div class="line">    <a class="code" href="pcrcalc_8h.html#ae02affc4b42263cf2aa930077f3267c0">PcrScript</a>* s;</div>
<div class="line">    <span class="keywordtype">char</span>* installError;</div>
<div class="line">    <span class="keywordflow">if</span> (argc &lt;= 1) {</div>
<div class="line">      fprintf(stderr,<span class="stringliteral">&quot;PCRaster XML client interface test driver\n&quot;</span>);</div>
<div class="line">      fprintf(stderr,<span class="stringliteral">&quot;USAGE: pcrcitd inputModelFile.xml\n&quot;</span>);</div>
<div class="line">      exit(1);</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *msg = <a class="code" href="pcrcalc_8h.html#a92e121a6e03706aa31488e5aeb0cb6af" title="Install the DevelopersLicense.">pcr_installDevelopersLicense</a>(licString);</div>
<div class="line">    <span class="keywordflow">if</span> (msg) {</div>
<div class="line">      fprintf(stderr,msg);</div>
<div class="line">      exit(1);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="comment">/* argv[1] is an xml file */</span></div>
<div class="line">    s=<a class="code" href="pcrcalc_8h.html#a7f99ded6ed5aa8a64e3f36c60f745e76" title="create the PcrScript object by supplying a filename of a XML file with the script root element...">pcr_createScriptFromXMLFile</a>(argv[1]);</div>
<div class="line">    <span class="keywordflow">if</span> (!s) {</div>
<div class="line">       printf(<span class="stringliteral">&quot;PANIC allocation of a few bytes failed&quot;</span>);</div>
<div class="line">       abort();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* typical error: case.xml is not existant */</span></div>
<div class="line">    checkError(s);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="pcrcalc_8h.html#a2fe8d8b91735be6311dd52ea89a5dd77" title="Execute entire script.">pcr_ScriptExecute</a>(s);</div>
<div class="line">    <span class="comment">/* typical errors:</span></div>
<div class="line"><span class="comment">       - case.xml is malformed</span></div>
<div class="line"><span class="comment">       - some inputs are not found</span></div>
<div class="line"><span class="comment">       - resource error: memory/disk full</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    checkError(s);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="pcrcalc_8h.html#a514a9ec3d9ade56ecc6b47c2620aceda" title="clean up PcrScript object">pcr_destroyScript</a>(s);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line"> }</div>
</div><!-- fragment --><p>The examples in csharp/ScriptTest.cs uses the API "as-is" in respect to minimizing the use of C# language features. Therefor the code can be used as examples for other client languages such as Java, Delphi or Visual Basic.</p>
<h1><a class="anchor" id="xmlDocumentation"></a>
The XML vocabulary</h1>
<p>A single XML vocabulary defined in PCRaster.xsd is used in two roles (in and out):</p>
<ul>
<li>in: <a class="el" href="pcrcalc_8h.html#a7f99ded6ed5aa8a64e3f36c60f745e76" title="create the PcrScript object by supplying a filename of a XML file with the script root element...">pcr_createScriptFromXMLFile()</a>, <a class="el" href="pcrcalc_8h.html#abdea59f214d50874fb22905127ac09c6" title="create the PcrScript object by supplying the XML as a string with the script root element...">pcr_createScriptFromXMLString()</a> to create a script.</li>
<li>out: pcr_ScriptXmlReflection() to retrieve meta information from a script.</li>
</ul>
<p>Within the PCRaster.xsd schema the XML nodes are documented within an xs:annotation element (view XML source in Visual Studio). The difference in application of the [in] and [out] case of certain nodes is clearly stated. Note that not all nodes present in PCRaster.xsd are used in the current API.</p>
<h1><a class="anchor" id="errorHandling"></a>
Error Handling</h1>
<p>All functions will store a possible error description in the PcrScript object. The success of all functions can be checked of the function call by evaluating the result of <a class="el" href="pcrcalc_8h.html#a7eda34df6c30d13450d01b52efcb431f">pcr_ScriptError()</a> and/or <a class="el" href="pcrcalc_8h.html#a06d9069e413faa07870f13015c40bded">pcr_ScriptErrorMessage()</a>. Errors on a PcrScript object are NOT recoverable; All successive calls on the same PcrScript will do nothing. A PcrScript object in error state should still be deleted with <a class="el" href="pcrcalc_8h.html#a514a9ec3d9ade56ecc6b47c2620aceda" title="clean up PcrScript object">pcr_destroyScript()</a>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed May 1 2013 22:15:44 for PCRaster LinkOut API by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1.2 </li>
  </ul>
</div>
</body>
</html>
